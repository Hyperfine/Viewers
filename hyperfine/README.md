# Hyperfine additions to PACS
## Hyperfine OHIF build docker
Hyperfine installation instructions

First - make sure you have a modern version of nodejs installed.
For example:

```nvm use v20.14.0```

Next -  follow the instructions in the root README (yarn config, yarn install)

```
yarn config set workspaces-experimental true
yarn install
```

Then - in the `./hyperfine/OpenResty-Orthanc-CarePMR/` directory
```docker-compose build```
and to launch
```docker-compose -f docker-compose.yml up -d```

The images are visible at address http://127.0.0.1. The Orthanc admin page is visible at http://127.0.0.1/pacs-admin/app/explorer.html.

## CarePMR PACS Upload Lambda

This needs to be installed as a lambda on AWS.

The trigger event generated by S3 when a *.dcm file is placed into the /success folder of in this bucket:
```
Bucket arn: arn:aws:s3:::purview-connector-dev
Event types: s3:ObjectCreated:*
```
The following environment variables need to be set. The following are the values
used for testing; in the future these will change.
```
CSTORE_CALLED_AET	ORTHANC
CSTORE_CALLING_AET	CAREPMR
CSTORE_HOST	75.101.185.224
CSTORE_PORT	4242
PMR_SERIAL_NUMBERS	HG23030011,HG23080015,HG23080016,HG23350055
```

The deployed lambda needs to have a layer configured which contains pynetdicom.
This will automatically include pydicom.
```
$ python3 -m venv lambda_layer

$ source lambda_layer/bin/activate

$ pip install pynetdicom
  Collecting pynetdicom
    Using cached pynetdicom-2.0.2-py3-none-any.whl (1.6 MB)
  Collecting pydicom>=2.2.0
    Using cached pydicom-2.4.4-py3-none-any.whl (1.8 MB)
  Installing collected packages: pydicom, pynetdicom
  Successfully installed pydicom-2.4.4 pynetdicom-2.0.2

$ pip freeze > requirements.txt

$ pip install -r requirements.txt -t ./python
  Collecting pydicom==2.4.4
    Using cached pydicom-2.4.4-py3-none-any.whl (1.8 MB)
  Collecting pynetdicom==2.0.2
    Using cached pynetdicom-2.0.2-py3-none-any.whl (1.6 MB)
  Installing collected packages: pydicom, pynetdicom
  Successfully installed pydicom-2.4.4 pynetdicom-2.0.2

$ zip -r pacs_upload.zip python/
```
